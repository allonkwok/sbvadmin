<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shenfangtao.mapper.UserMapper">
    <select id="getUserRolesByUid" resultType="com.shenfangtao.model.Role">
        select * from role r,user_role ur where r.id=ur.rid and ur.uid=#{id}
    </select>

    <resultMap id="BaseResultMap" type="com.shenfangtao.model.User">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="nickname" property="nickname" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="CHAR"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="activated" property="activated" jdbcType="BIT"/>
        <result column="locked" property="locked" jdbcType="BIT"/>
        <result column="username" property="username" jdbcType="VARCHAR"/>
        <result column="avatar" property="avatar" jdbcType="VARCHAR"/>
        <result column="last_login_at" property="lastLoginAt" jdbcType="TIMESTAMP"/>
        <result column="last_login_ip" property="lastLoginIp" jdbcType="VARCHAR"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
    </resultMap>
    <resultMap id="UserWithRoles" type="com.shenfangtao.model.User" extends="BaseResultMap">
        <collection property="roles" ofType="com.shenfangtao.model.Role">
            <id column="rid" property="id"/>
            <result column="rname" property="name"/>
            <result column="rname_zh" property="nameZh"/>
        </collection>
    </resultMap>
    <select id="getUsersWithRoles" resultMap="UserWithRoles">
        select user.id, user.nickname, user.phone, user.email, user.activated, user.locked, user.username, user.avatar,
        user.last_login_at,user.last_login_ip,user.created_at,user.updated_at,r.`id` as rid,r.`name` as rname,r.`name_zh` as rname_zh from user left join user_role ur on
        user.`id`=ur.`uid` left join role r on ur.`rid`=r.`id`
    </select>
</mapper>